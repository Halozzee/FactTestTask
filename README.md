# FactTestTask

## Краткий обзор
Проект представляет собой решение, состоящие из двух проектов:

* DataLayer
* FactTestTask

#### Проект DataLayer 
Представляет собой библиотеку классов и содержит в себе классы и методы, позволяющие взаимодействовать с базой данных. Сама база подключается в FactTestTask (.mdf файл) и она подключается 
по автоматически формируемому пути.
#### Проект FactTestTask 
Представляет собой web-приложение ASP.NET Core с использованием MVC. Активно взаимодействует с проектом DataLayer для "общения" с базой данных. 

Содержит в себе Views, Controllers и некоторые из Models. 

Большая часть моделей для представления объектов описана в DataLayer. В целях избежания 
дублирования кода, некоторые модели не были перенесены в папку Models проекта FactTestTask, но были добавлены соответствующие ссылки на используемые пространства имен.

## Назначение файлов

### Проект DataLayer 

#### Директория DataBase
* DrinkDeliveryMaster - класс для взаимодействования с базой данных посредством Enitity Framework. Содержит в себе методы, которые напрямую взаимодействуют с контекстом и возвращают
результат в виде объектов или же позволяют вносить изменения в базу из других частей решения.
* EFDBContext - контекст Entity Framework Core.

#### Директория DataBase
* Drink - представляет собой модель напитка. Имеет свойства, необходимые для отображения на фронте. Хранится в БД.
* CustomerData - представляет собой статический класс для взаимодействия с "покупателем". Содержит данные о том, какие монеты доступны к использованию, текущий баланс "покупателя".
* DrinkAvailability - представляет собой модель хранящую данные о доступности напитка. Хранит количество и флаг о возможности приобритения напитка. Хранится в БД.
* DrinkWithAvailability - представляет собой модель слияния данных Drink и DrinkAvailability. Не хранится в базе данных в силу "негибкости" настройки.

#### Директория Migrations
Служебная директория Entity Framework core, в которой хранятся "миграции".

### Проект FactTestTask

#### Директория Controller
Хранит в себе Controllers, которые будут взаимодействовать с Views посредством AJAX-запросов и формирования самих Views. 

* AdminController - представляет собой контроллер для страницы админ-панели.
* CustomerController - представляет собой контроллер для страницы "покупателя".

#### Директория Views
Содержит в себе Views и PartialViews для отображения Web-страницы.

* Shared - Общая часть View, из важного: хранит в себе navbar и footer.
* Customer - хранит Index для страницы "покупателя" и также хранит в себе PartialView для отрисовки блока карточек с напитками.
* Admin - хранит Index для страницы админ-панели, переадресацию на страницу с неправильно введенным паролем и PartialView для отрисовки элемента таблицы в админ-панели.

#### Директория App_data
Содержит в себе testdb.mdf - файл БД и лог к нему (testdb_log.ldf).

#### Директория Models
Содержит в себе 2 созданные модели и 1 сгенерированную по стандарту MVC-приложения. Ниже описание только созданные вручную.

* DrinkTransactionResult - модель созданная для AJAX-запроса, представляющая собой результат "покупки" напитка. Передает в себе новый баланс "покупателя" и имеет 5 кодов результата операции:
  - 0: None - Debug код. Показывает отсутствие указанного программистом параметра.
  - 1: Success - успех операции. "Покупка" прошла успешно, напитки еще есть. Один напиток списывается.
  - 2: InsufficientFunds - недостаточно средств для приобритения напитка. Напиток не списывается.
  - 3: LastItemBought - успех операции. "Покупка" прошла успешно, напитков больше нет. Один напиток списывается.
  - 4: Unavailable - операция не прошла. "Покупка" не может быть совершена в силу того, что напиток запрещен к продаже. Напиток не списывается.
 
 ### Проект FactTestTask wwwroot
 
 #### Директория img
 Содержит в себе 2 изображения, каждый в своей папке. Первый файл представляет собой изображения грустного смайлика ( :( ) для страницы админ-панели, когда на той введен неверный пароль.
 Второй файл представляет собой Default value для img нового напитка, если в том не был указано другое изображение вручную.
 
 #### Директория js
 Содержит 3 скрипта: 1 сгенерированный и 2 созданных. Ниже описание только созданные вручную.
 
 * customerPage.js представляет собой скрипт для страницы `Customer/index` с описанными AJAX-запросами к серверу и функциями для изменения кода страницы.
 * adminPage.js представляет собой скрипт для страницы `Admin/index` с описанными AJAX-запросами к серверу и функциями для изменения кода страницы.
 
 #### Директория lib
 Содержит в себе подключенные автоматически библиотеки (bootstrap и jquery).
 
 #### Директория css
 Содержит сгенерированные стили для web-приложения.
  
## Как работать с приложением

Как работать с приложением описано [инструкции](instruction.md).
